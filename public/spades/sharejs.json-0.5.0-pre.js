minispade.register('sharejs.json', "(function() {((function(){var a,b,c,d,e,f,g,h,i,j,k=!0,l=Array.prototype.slice,m=window.sharejs;typeof k!=\"undefined\"&&k!==null?i=m.types.text:i=require(\"./text\"),f={},f.name=\"json\",f.create=function(){return null},f.invertComponent=function(a){var b={p:a.p};return a.si!==void 0&&(b.sd=a.si),a.sd!==void 0&&(b.si=a.sd),a.oi!==void 0&&(b.od=a.oi),a.od!==void 0&&(b.oi=a.od),a.li!==void 0&&(b.ld=a.li),a.ld!==void 0&&(b.li=a.ld),a.na!==void 0&&(b.na=-a.na),a.lm!==void 0&&(b.lm=a.p[a.p.length-1],b.p=a.p.slice(0,a.p.length-1).concat([a.lm])),b},f.invert=function(a){var b,c,d,e=a.slice().reverse(),g=[];for(c=0,d=e.length;c<d;c++)b=e[c],g.push(f.invertComponent(b));return g},f.checkValidOp=function(){},e=function(a){return Object.prototype.toString.call(a)===\"[object Array]\"},f.checkList=function(a){if(!e(a))throw new Error(\"Referenced element not a list\")},f.checkObj=function(a){if(a.constructor!==Object)throw new Error(\"Referenced element not an object (it was \"+JSON.stringify(a)+\")\")},f.apply=function(a,c){var d,e,g,h,i,j,k,l,m,n,o,p,q;f.checkValidOp(c),c=b(c),e={data:b(a)};try{for(i=0,o=c.length;i<o;i++){d=c[i],l=null,m=null,h=e,j=\"data\",q=d.p;for(n=0,p=q.length;n<p;n++){k=q[n],l=h,m=j,h=h[j],j=k;if(l==null)throw new Error(\"Path invalid\")}if(d.na!==void 0){if(typeof h[j]!=\"number\")throw new Error(\"Referenced element not a number\");h[j]+=d.na}else if(d.si!==void 0){if(typeof h!=\"string\")throw new Error(\"Referenced element not a string (it was \"+JSON.stringify(h)+\")\");l[m]=h.slice(0,j)+d.si+h.slice(j)}else if(d.sd!==void 0){if(typeof h!=\"string\")throw new Error(\"Referenced element not a string\");if(h.slice(j,j+d.sd.length)!==d.sd)throw new Error(\"Deleted string does not match\");l[m]=h.slice(0,j)+h.slice(j+d.sd.length)}else if(d.li!==void 0&&d.ld!==void 0)f.checkList(h),h[j]=d.li;else if(d.li!==void 0)f.checkList(h),h.splice(j,0,d.li);else if(d.ld!==void 0)f.checkList(h),h.splice(j,1);else if(d.lm!==void 0)f.checkList(h),d.lm!==j&&(g=h[j],h.splice(j,1),h.splice(d.lm,0,g));else if(d.oi!==void 0)f.checkObj(h),h[j]=d.oi;else{if(d.od===void 0)throw new Error(\"invalid / missing instruction in op\");f.checkObj(h),delete h[j]}}}catch(r){throw r}return e.data},f.pathMatches=function(a,b,c){var d,e,f;if(a.length!==b.length)return!1;for(d=0,f=a.length;d<f;d++){e=a[d];if(e!==b[d]&&(!c||d!==a.length-1))return!1}return!0},f.append=function(a,c){var d;return c=b(c),a.length!==0&&f.pathMatches(c.p,(d=a[a.length-1]).p)?d.na!==void 0&&c.na!==void 0?a[a.length-1]={p:d.p,na:d.na+c.na}:d.li!==void 0&&c.li===void 0&&c.ld===d.li?d.ld!==void 0?delete d.li:a.pop():d.od!==void 0&&d.oi===void 0&&c.oi!==void 0&&c.od===void 0?d.oi=c.oi:c.lm!==void 0&&c.p[c.p.length-1]===c.lm?null:a.push(c):a.push(c)},f.compose=function(a,c){var d,e,g,h;f.checkValidOp(a),f.checkValidOp(c),e=b(a);for(g=0,h=c.length;g<h;g++)d=c[g],f.append(e,d);return e},f.normalize=function(a){var b,c,d,g=[];e(a)||(a=[a]);for(c=0,d=a.length;c<d;c++)b=a[c],b.p==null&&(b.p=[]),f.append(g,b);return g},b=function(a){return JSON.parse(JSON.stringify(a))},f.commonPath=function(a,b){var c;a=a.slice(),b=b.slice(),a.unshift(\"data\"),b.unshift(\"data\"),a=a.slice(0,a.length-1),b=b.slice(0,b.length-1);if(b.length===0)return-1;c=0;while(a[c]===b[c]&&c<a.length){c++;if(c===b.length)return c-1}},f.transformComponent=function(a,c,d,e){var g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;c=b(c),c.na!==void 0&&c.p.push(0),d.na!==void 0&&d.p.push(0),g=f.commonPath(c.p,d.p),h=f.commonPath(d.p,c.p),l=c.p.length,p=d.p.length,c.na!==void 0&&c.p.pop(),d.na!==void 0&&d.p.pop();if(d.na)return h!=null&&p>=l&&d.p[h]===c.p[h]&&(c.ld!==void 0?(o=b(d),o.p=o.p.slice(l),c.ld=f.apply(b(c.ld),[o])):c.od!==void 0&&(o=b(d),o.p=o.p.slice(l),c.od=f.apply(b(c.od),[o]))),f.append(a,c),a;h!=null&&p>l&&c.p[h]===d.p[h]&&(c.ld!==void 0?(o=b(d),o.p=o.p.slice(l),c.ld=f.apply(b(c.ld),[o])):c.od!==void 0&&(o=b(d),o.p=o.p.slice(l),c.od=f.apply(b(c.od),[o])));if(g!=null){j=l===p;if(d.na===void 0)if(d.si!==void 0||d.sd!==void 0){if(c.si!==void 0||c.sd!==void 0){if(!j)throw new Error(\"must be a string?\");k=function(a){var b={p:a.p[a.p.length-1]};return a.si?b.i=a.si:b.d=a.sd,b},v=k(c),w=k(d),t=[],i._tc(t,v,w,e);for(y=0,z=t.length;y<z;y++)u=t[y],n={p:c.p.slice(0,g)},n.p.push(u.p),u.i!=null&&(n.si=u.i),u.d!=null&&(n.sd=u.d),f.append(a,n);return a}}else if(d.li!==void 0&&d.ld!==void 0){if(d.p[g]===c.p[g]){if(!j)return a;if(c.ld!==void 0){if(c.li===void 0||e!==\"left\")return a;c.ld=b(d.li)}}}else if(d.li!==void 0)c.li!==void 0&&c.ld===void 0&&j&&c.p[g]===d.p[g]?e===\"right\"&&c.p[g]++:d.p[g]<=c.p[g]&&c.p[g]++,c.lm!==void 0&&j&&d.p[g]<=c.lm&&c.lm++;else if(d.ld!==void 0){if(c.lm!==void 0&&j){if(d.p[g]===c.p[g])return a;s=d.p[g],m=c.p[g],x=c.lm,(s<x||s===x&&m<x)&&c.lm--}if(d.p[g]<c.p[g])c.p[g]--;else if(d.p[g]===c.p[g]){if(p<l)return a;if(c.ld!==void 0){if(c.li===void 0)return a;delete c.ld}}}else if(d.lm!==void 0)if(c.lm!==void 0&&l===p){m=c.p[g],x=c.lm,q=d.p[g],r=d.lm;if(q!==r)if(m===q){if(e!==\"left\")return a;c.p[g]=r,m===x&&(c.lm=r)}else m>q&&c.p[g]--,m>r?c.p[g]++:m===r&&q>r&&(c.p[g]++,m===x&&c.lm++),x>q?c.lm--:x===q&&x>m&&c.lm--,x>r?c.lm++:x===r&&(r>q&&x>m||r<q&&x<m?e===\"right\"&&c.lm++:x>m?c.lm++:x===q&&c.lm--)}else c.li!==void 0&&c.ld===void 0&&j?(m=d.p[g],x=d.lm,s=c.p[g],s>m&&c.p[g]--,s>x&&c.p[g]++):(m=d.p[g],x=d.lm,s=c.p[g],s===m?c.p[g]=x:(s>m&&c.p[g]--,s>x?c.p[g]++:s===x&&m>x&&c.p[g]++));else if(d.oi!==void 0&&d.od!==void 0){if(c.p[g]===d.p[g]){if(c.oi===void 0||!j)return a;if(e===\"right\")return a;c.od=d.oi}}else if(d.oi!==void 0){if(c.oi!==void 0&&c.p[g]===d.p[g]){if(e!==\"left\")return a;f.append(a,{p:c.p,od:d.oi})}}else if(d.od!==void 0&&c.p[g]===d.p[g]){if(!j)return a;if(c.oi===void 0)return a;delete c.od}}return f.append(a,c),a},typeof k!=\"undefined\"&&k!==null?(m.types||(m.types={}),m._bt(f,f.transformComponent,f.checkValidOp,f.append),m.types.json=f):(module.exports=f,require(\"./helpers\").bootstrapTransform(f,f.transformComponent,f.checkValidOp,f.append)),typeof k==\"undefined\"&&(f=require(\"./json\")),typeof k!=\"undefined\"&&k!==null&&(d=m.extendDoc,m.extendDoc=function(b,c){return a.prototype[b]=c,d(b,c)}),c=function(a){return a.length===1&&a[0].constructor===Array?a[0]:a},g=function(a,b){var c,d,e=[];for(c in b){d=b[c];if(!a[c]){a[c]=d;continue}switch(a[c].constructor){case Array:e.push(a[c]=a[c].concat(d));break;case Object:e.push(g(a[c],d));break;default:e.push(void 0)}}return e},a=function(){function a(a,b){this.doc=a,this.path=b}return a.prototype.at=function(){var a=1<=arguments.length?l.call(arguments,0):[];return this.doc.at(this.path.concat(c(a)))},a.prototype.get=function(){return this.doc.getAt(this.path)},a.prototype.set=function(a,b){return this.doc.setAt(this.path,a,b)},a.prototype.insert=function(a,b,c){return this.doc.insertAt(this.path,a,b,c)},a.prototype.del=function(a,b,c){return this.doc.deleteTextAt(this.path,b,a,c)},a.prototype.remove=function(a){return this.doc.removeAt(this.path,a)},a.prototype.push=function(a,b){return this.insert(this.get().length,a,b)},a.prototype.move=function(a,b,c){return this.doc.moveAt(this.path,a,b,c)},a.prototype.add=function(a,b){return this.doc.addAt(this.path,a,b)},a.prototype.on=function(a,b){return this.doc.addListener(this.path,a,b)},a.prototype.removeListener=function(a){return this.doc.removeListener(a)},a.prototype.getLength=function(){return this.get().length},a.prototype.getText=function(){return this.get()},a}(),j=function(a,b){var c,d,e,f={data:a},g=\"data\",h=f;for(d=0,e=b.length;d<e;d++){c=b[d],h=h[g],g=c;if(typeof h==\"undefined\")throw new Error(\"bad path\")}return{elem:h,key:g}},h=function(a,b){var c,d,e;if(a.length!==b.length)return!1;for(d=0,e=a.length;d<e;d++){c=a[d];if(c!==b[d])return!1}return!0},f.api={provides:{json:!0},at:function(){var b=1<=arguments.length?l.call(arguments,0):[];return new a(this,c(b))},get:function(){return this.snapshot},set:function(a,b){return this.setAt([],a,b)},getAt:function(a){var b=j(this.snapshot,a),c=b.elem,d=b.key;return c[d]},setAt:function(a,b,c){var d=j(this.snapshot,a),e=d.elem,f=d.key,g={p:a};if(e.constructor===Array)g.li=b,typeof e[f]!=\"undefined\"&&(g.ld=e[f]);else{if(typeof e!=\"object\")throw new Error(\"bad path\");g.oi=b,typeof e[f]!=\"undefined\"&&(g.od=e[f])}return this.submitOp([g],c)},removeAt:function(a,b){var c,d=j(this.snapshot,a),e=d.elem,f=d.key;if(typeof e[f]==\"undefined\")throw new Error(\"no element at that path\");c={p:a};if(e.constructor===Array)c.ld=e[f];else{if(typeof e!=\"object\")throw new Error(\"bad path\");c.od=e[f]}return this.submitOp([c],b)},insertAt:function(a,b,c,d){var e=j(this.snapshot,a),f=e.elem,g=e.key,h={p:a.concat(b)};return f[g].constructor===Array?h.li=c:typeof f[g]==\"string\"&&(h.si=c),this.submitOp([h],d)},moveAt:function(a,b,c,d){var e=[{p:a.concat(b),lm:c}];return this.submitOp(e,d)},addAt:function(a,b,c){var d=[{p:a,na:b}];return this.submitOp(d,c)},deleteTextAt:function(a,b,c,d){var e=j(this.snapshot,a),f=e.elem,g=e.key,h=[{p:a.concat(c),sd:f[g].slice(c,c+b)}];return this.submitOp(h,d)},addListener:function(a,b,c){var d,e,f,g,h,i,j,k,l=this._listeners;for(h=0,i=a.length;h<i;h++)e=a[h],l=(j=(f=l.segments)[e])!=null?j:f[e]={segments:{},events:{}};return d=(k=(g=l.events)[b])!=null?k:g[b]=[],d.push(c),c.removeListener=function(){var a=d.indexOf(c);return a<0?!1:(d.splice(a,1),!0)},c},removeListener:function(a){return a.removeListener()},_register:function(){return this._listeners={segments:{},events:{}},this.on(\"change\",function(a){var b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t=[];for(l=0,o=a.length;l<o;l++){b=a[l];if(b.na!==void 0||b.si!==void 0||b.sd!==void 0)continue;d=this._listeners,h=[],r=b.p;for(m=0,p=r.length;m<p;m++)i=r[m],d=d!=null?d.segments[i]:void 0,h.push(i);if(!d)continue;c={p:h,na:0},j=this.type.transformComponent([],c,b,\"left\");if(j.length===0)console.log(\"noop\"),d.segments={},t.push(d.events={});else{if(!(j.length=1))throw new Error(\"Bad assumption in json-api: xforming an 'si' op will always result in 0 or 1 components.\");console.log(\"xformed\"),f=j[0].p,e=this._listeners;for(n=0,q=f.length;n<q;n++)i=f[n],e=(s=(k=e.segments)[i])!=null?s:k[i]={segments:{},events:{}};g(e,d),d.segments={},t.push(d.events={})}}return t}),this.on(\"remoteop\",function(a){var b,c,d,e,f,g,h,i,j,k,l,m=[];for(i=0,k=a.length;i<k;i++){c=a[i],g=c.na===void 0?c.p.slice(0,c.p.length-1):c.p,f=this._listeners,console.log(\"RO\");for(j=0,l=g.length;j<l;j++)h=g[j],f=f.segments[h];c.li!==void 0&&c.ld===void 0?(e=\"insert\",b=[c.p[c.p.length-1],c.li]):c.oi!==void 0&&c.od===void 0?(e=\"insert\",b=[c.p[c.p.length-1],c.oi]):c.si!==void 0?(e=\"insert\",b=[c.p[c.p.length-1],c.si]):c.li===void 0&&c.ld!==void 0?(e=\"delete\",b=[c.p[c.p.length-1],c.ld]):c.oi===void 0&&c.od!==void 0?(e=\"delete\",b=[c.p[c.p.length-1],c.od]):c.sd!==void 0?(e=\"delete\",b=[c.p[c.p.length-1],c.sd]):c.li!==void 0&&c.ld!==void 0?(e=\"replace\",b=[c.p[c.p.length-1],c.ld,c.li]):c.oi!==void 0&&c.od!==void 0?(e=\"replace\",b=[c.p[c.p.length-1],c.od,c.oi]):c.lm!==void 0?(e=\"move\",b=[c.p[c.p.length-1],c.lm]):c.na!==void 0&&(e=\"add\",b=[c.na]),m.push(function(){var a,c,g=(f!=null?f.events[e]:void 0)||[],h=[];for(a=0,c=g.length;a<c;a++)d=g[a],h.push(d.apply(null,b));return h}())}return m})}}})).call(this)\n})();\n//@ sourceURL=sharejs.json");